<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekly Attendance Report</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>
        /* --- 1. THEME DEFINITIONS --- */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        :root {
            --primary-color: #00ADB5; /* Main Teal/Cyan */
            --card-bg: #393E46;
            --dark-bg: #222831;
            --text-color: #EEEEEE;
            --text-muted: #A0A0A0;
            --error-color: #FF6B6B;
            --success-color: #4CAF50;
            --warning-color: #FFD166;

            /* CUSTOM BUTTON COLORS */
            --nav-highlight-color: #4DD0E1; /* Light Blue/Cyan for Previous/Next week */
            --neutral-btn-color: #555; /* Neutral grey for Back button */
            --current-week-color: #00ADB5; /* Use Primary Color for Current Week */
        }

        /* --- 2. BASE & LAYOUT STYLES --- */
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--dark-bg);
            color: var(--text-color);
        }
        h1 {
            color: var(--primary-color);
            margin-bottom: 5px;
        }
        .container {
            width: 95%;
            margin: 0 auto;
        }
        .report-period {
            color: var(--text-muted);
            margin-bottom: 25px;
            display: block;
        }

        /* --- 3. WEEK SELECTOR & BUTTON STYLES --- */
        .week-selector {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            gap: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        /* Base styling for all functional buttons in the selector */
        .week-selector a {
            padding: 8px 15px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: background-color 0.2s;
            display: inline-block;
            white-space: nowrap; /* Prevent button text from wrapping */
        }

        /* A. Back to Admin Panel Button (Neutral/Original Color) */
        .back-btn {
            background-color: var(--neutral-btn-color); /* Neutral grey */
            color: white;
        }
        .back-btn:hover {
            background-color: #666;
        }

        /* B. Previous/Next Week Navigation Buttons (Highlight Color) */
        .week-btn {
            background-color: var(--nav-highlight-color); /* Light Blue/Cyan Highlight */
            color: var(--dark-bg); /* Dark text for contrast */
        }
        .week-btn:hover {
            background-color: var(--current-week-color);
            color: white;
        }

        /* C. Current Week Button (Primary Color) */
        .week-btn.current {
            background-color: var(--current-week-color);
            color: white;
        }
        .week-btn.current:hover {
            background-color: #008C91; /* Slightly darker hover for current */
        }

        /* D. Disabled State */
        .week-btn.disabled {
            background-color: #31363F !important; /* Important to override highlight */
            color: var(--text-muted);
            pointer-events: none;
            cursor: default;
        }


        /* --- 4. TABLE & DATA STYLES --- */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: var(--card-bg);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }
        .report-container {
            overflow-x: auto;
            width: 100%;
        }
        .report-container table {
            min-width: 900px;
            table-layout: fixed;
        }
        th, td {
            padding: 12px 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            vertical-align: middle;
        }
        th {
            background-color: var(--primary-color);
            color: var(--dark-bg);
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.9em;
            font-weight: 600;
            white-space: nowrap;
        }
        tr:nth-child(even) {
            background-color: #31363F;
        }
        tr:hover {
            background-color: #4A515A;
        }

        /* Color-Coding for Hours */
        .hours-box {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: 600;
            white-space: nowrap;
            min-width: 80px;
            text-align: center;
        }
        .net-ok {
            background-color: rgba(76, 175, 80, 0.2);
            color: var(--success-color);
        }
        .net-under {
            background-color: rgba(255, 107, 107, 0.2);
            color: var(--error-color);
        }
        .net-over {
            background-color: rgba(255, 209, 102, 0.2);
            color: var(--warning-color);
        }
        .break-hours-color {
            background-color: rgba(0, 173, 181, 0.2);
            color: var(--primary-color);
        }

        /* --- 5. PAGINATION STYLES --- */
        .pagination-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
        }
        .pagination {
            display: flex;
            padding-left: 0;
            list-style: none;
            border-radius: .25rem;
        }
        .page-item {
            margin: 0 2px;
        }
        .page-link {
            padding: 8px 12px;
            line-height: 1.25;
            color: var(--primary-color);
            background-color: var(--card-bg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-decoration: none;
            border-radius: 4px;
            display: block;
        }
        .page-link:hover {
            color: var(--text-color);
            background-color: #4A515A;
        }
        .page-item.active .page-link {
            color: var(--dark-bg);
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        .page-item.disabled .page-link {
            color: var(--text-muted);
            pointer-events: none;
            background-color: #31363F;
        }
        .pagination-info {
            color: var(--text-muted);
            font-size: 0.9em;
        }
    </style>
</head>

<body>

<div class="container report-container">

<h1>Weekly Attendance Report</h1>

<span class="report-period">Data for the period: **{{ report_start_date }}** to **{{ report_end_date }}**.</span>

<div class="week-selector">
    <a href="{{ url_for('admin_panel') }}" class="back-btn">â¬… Back to Admin Panel</a>

    <a href="{{ url_for('weekly_report', week=current_week_offset - 1) }}" class="week-btn">
        <i class="fas fa-arrow-left"></i> Previous Week
    </a>

    <a href="{{ url_for('weekly_report', week=current_week_offset + 1) }}"
       class="week-btn {% if current_week_offset >= 0 %}disabled{% endif %}">
        Next Week <i class="fas fa-arrow-right"></i>
    </a>

    {% if current_week_offset != 0 %}
        <a href="{{ url_for('weekly_report', week=0) }}" class="week-btn current">
            Current Week
        </a>
    {% endif %}
</div>
{% if weekly_data %}
<table>
    <thead>
        <tr>
            <th class="col-id">ID</th>
            <th class="col-name">Employee Name</th>
            <th class="col-shifts">Shifts Completed</th>
            <th class="col-net-hours">Total Net Work Hours</th>
            <th class="col-break-hours">Total Break Hours</th>
        </tr>
    </thead>

    <tbody>
        {% for employee_report in weekly_data %}
        <tr>
            <td class="col-id">{{ employee_report.emp_id }}</td>
            <td class="col-name">{{ employee_report.name }}</td>
            <td class="col-shifts">{{ employee_report.shifts_completed }}</td>

            <td class="col-net-hours">
                {% set net_minutes = employee_report.total_net_work_hours * 60 %}

                {% if net_minutes > 2700 %}
                    {% set net_class = 'net-over' %}
                {% elif net_minutes < 2100 and net_minutes > 0 %}
                    {% set net_class = 'net-under' %}
                {% else %}
                    {% set net_class = 'net-ok' %}
                {% endif %}

                <span class="hours-box {{ net_class }}">
                    {{ employee_report.total_net_work_hours | round(1) }} h
                </span>
            </td>

            <td class="col-break-hours">
                <span class="hours-box break-hours-color">
                    {{ employee_report.total_break_hours | round(1) }} h
                </span>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<div class="pagination-container">
    {% if total_pages > 1 %}
        <nav aria-label="Page navigation">
            <ul class="pagination">
                <li class="page-item {% if page == 1 %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('weekly_report', page=page - 1, week=current_week_offset) }}" aria-label="Previous">
                        <span aria-hidden="true">&laquo;</span>
                    </a>
                </li>

                {% for p in pages %}
                    <li class="page-item {% if p == page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('weekly_report', page=p, week=current_week_offset) }}">{{ p }}</a>
                    </li>
                {% endfor %}

                <li class="page-item {% if page == total_pages %}disabled{% endif %}">
                    <a class="page-link" href="{{ url_for('weekly_report', page=page + 1, week=current_week_offset) }}" aria-label="Next">
                        <span aria-hidden="true">&raquo;</span>
                    </a>
                </li>
            </ul>
        </nav>
        <p class="pagination-info">Page {{ page }} of {{ total_pages }}</p>
    {% endif %}
</div>
{% else %}
<p>No weekly attendance data to display for this period ({{ report_start_date }} to {{ report_end_date }}).</p>
{% endif %}

</div>

</body>
</html>